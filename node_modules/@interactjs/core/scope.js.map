{
	"version": 3,
	"names": [
		"browser",
		"clone",
		"domObjects",
		"extend",
		"is",
		"raf",
		"win",
		"Eventable",
		"InteractEvent",
		"createInteractStatic",
		"Interactable",
		"InteractableBase",
		"InteractableSet",
		"events",
		"interactions",
		"defaults",
		"Scope",
		"id",
		"Math",
		"floor",
		"random",
		"isInitialized",
		"listenerMaps",
		"actions",
		"map",
		"phases",
		"start",
		"move",
		"end",
		"methodDict",
		"phaselessTypes",
		"interactStatic",
		"interactables",
		"_win",
		"document",
		"window",
		"documents",
		"_plugins",
		"list",
		"constructor",
		"scope",
		"_defaults",
		"set",
		"options",
		"fire",
		"interactable",
		"unset",
		"index",
		"indexOf",
		"splice",
		"addListeners",
		"push",
		"name",
		"arg",
		"listener",
		"onWindowUnload",
		"event",
		"removeDocument",
		"target",
		"init",
		"initScope",
		"pluginIsInstalled",
		"plugin",
		"usePlugin",
		"install",
		"listeners",
		"before",
		"len",
		"length",
		"reduce",
		"acc",
		"pluginIdRoot",
		"otherId",
		"addDocument",
		"doc",
		"getDocIndex",
		"getWindow",
		"add",
		"remove",
		"i",
		"getDocOptions",
		"docIndex",
		"now",
		"Date",
		"replace"
	],
	"sources": [
		"scope.ts"
	],
	"sourcesContent": [
		"import type Interaction from '@interactjs/core/Interaction'\nimport browser from '@interactjs/utils/browser'\nimport clone from '@interactjs/utils/clone'\nimport domObjects from '@interactjs/utils/domObjects'\nimport extend from '@interactjs/utils/extend'\nimport is from '@interactjs/utils/is'\nimport raf from '@interactjs/utils/raf'\nimport * as win from '@interactjs/utils/window'\n\nimport { Eventable } from './Eventable'\nimport { InteractEvent } from './InteractEvent'\nimport { createInteractStatic } from './InteractStatic'\nimport { Interactable as InteractableBase } from './Interactable'\nimport { InteractableSet } from './InteractableSet'\nimport events from './events'\nimport interactions from './interactions'\nimport type { OptionsArg } from './options'\nimport { defaults } from './options'\nimport type { Actions } from './types'\n\nexport interface SignalArgs {\n  'scope:add-document': DocSignalArg\n  'scope:remove-document': DocSignalArg\n  'interactable:unset': { interactable: InteractableBase }\n  'interactable:set': { interactable: InteractableBase, options: OptionsArg }\n  'interactions:destroy': { interaction: Interaction }\n}\n\nexport type ListenerName = keyof SignalArgs\n\nexport type ListenerMap = {\n  [P in ListenerName]?: (arg: SignalArgs[P], scope: Scope, signalName: P) => void | boolean\n}\n\ninterface DocSignalArg {\n  doc: Document\n  window: Window\n  scope: Scope\n  options: Record<string, any>\n}\n\nexport interface Plugin {\n  [key: string]: any\n  id?: string\n  listeners?: ListenerMap\n  before?: string[]\n  install?(scope: Scope, options?: any): void\n}\n\nexport class Scope {\n  id = `__interact_scope_${Math.floor(Math.random() * 100)}`\n  isInitialized = false\n  listenerMaps: Array<{\n    map: ListenerMap\n    id: string\n  }> = []\n\n  browser = browser\n  defaults = clone(defaults) as typeof defaults\n  Eventable = Eventable\n  actions: Actions = {\n    map: {},\n    phases: {\n      start: true,\n      move: true,\n      end: true,\n    },\n    methodDict: {} as any,\n    phaselessTypes: {},\n  }\n\n  interactStatic = createInteractStatic(this)\n  InteractEvent = InteractEvent\n  Interactable: typeof InteractableBase\n  interactables = new InteractableSet(this)\n\n  // main window\n  _win!: Window\n\n  // main document\n  document!: Document\n\n  // main window\n  window!: Window\n\n  // all documents being listened to\n  documents: Array<{ doc: Document, options: any }> = []\n\n  _plugins: {\n    list: Plugin[]\n    map: { [id: string]: Plugin }\n  } = {\n      list: [],\n      map: {},\n    }\n\n  constructor () {\n    const scope = this\n\n    this.Interactable = class extends InteractableBase {\n      get _defaults () {\n        return scope.defaults\n      }\n\n      set<T extends InteractableBase> (this: T, options: OptionsArg) {\n        super.set(options)\n\n        scope.fire('interactable:set', {\n          options,\n          interactable: this,\n        })\n\n        return this\n      }\n\n      unset (this: InteractableBase) {\n        super.unset()\n\n        const index = scope.interactables.list.indexOf(this)\n        if (index < 0) return\n\n        super.unset()\n        scope.interactables.list.splice(index, 1)\n        scope.fire('interactable:unset', { interactable: this })\n      }\n    }\n  }\n\n  addListeners (map: ListenerMap, id?: string) {\n    this.listenerMaps.push({ id, map })\n  }\n\n  fire<T extends ListenerName> (name: T, arg: SignalArgs[T]): void | false {\n    for (const {\n      map: { [name]: listener },\n    } of this.listenerMaps) {\n      if (!!listener && listener(arg as any, this, name as never) === false) {\n        return false\n      }\n    }\n  }\n\n  onWindowUnload = (event: BeforeUnloadEvent) => this.removeDocument(event.target as Document)\n\n  init (window: Window | typeof globalThis) {\n    return this.isInitialized ? this : initScope(this, window)\n  }\n\n  pluginIsInstalled (plugin: Plugin) {\n    return this._plugins.map[plugin.id] || this._plugins.list.indexOf(plugin) !== -1\n  }\n\n  usePlugin (plugin: Plugin, options?: { [key: string]: any }) {\n    if (!this.isInitialized) {\n      return this\n    }\n\n    if (this.pluginIsInstalled(plugin)) {\n      return this\n    }\n\n    if (plugin.id) {\n      this._plugins.map[plugin.id] = plugin\n    }\n    this._plugins.list.push(plugin)\n\n    if (plugin.install) {\n      plugin.install(this, options)\n    }\n\n    if (plugin.listeners && plugin.before) {\n      let index = 0\n      const len = this.listenerMaps.length\n      const before = plugin.before.reduce((acc, id) => {\n        acc[id] = true\n        acc[pluginIdRoot(id)] = true\n        return acc\n      }, {})\n\n      for (; index < len; index++) {\n        const otherId = this.listenerMaps[index].id\n\n        if (before[otherId] || before[pluginIdRoot(otherId)]) {\n          break\n        }\n      }\n\n      this.listenerMaps.splice(index, 0, { id: plugin.id, map: plugin.listeners })\n    } else if (plugin.listeners) {\n      this.listenerMaps.push({ id: plugin.id, map: plugin.listeners })\n    }\n\n    return this\n  }\n\n  addDocument (doc: Document, options?: any): void | false {\n    // do nothing if document is already known\n    if (this.getDocIndex(doc) !== -1) {\n      return false\n    }\n\n    const window = win.getWindow(doc)\n\n    options = options ? extend({}, options) : {}\n\n    this.documents.push({ doc, options })\n    this.events.documents.push(doc)\n\n    // don't add an unload event for the main document\n    // so that the page may be cached in browser history\n    if (doc !== this.document) {\n      this.events.add(window, 'unload', this.onWindowUnload)\n    }\n\n    this.fire('scope:add-document', { doc, window, scope: this, options })\n  }\n\n  removeDocument (doc: Document) {\n    const index = this.getDocIndex(doc)\n\n    const window = win.getWindow(doc)\n    const options = this.documents[index].options\n\n    this.events.remove(window, 'unload', this.onWindowUnload)\n\n    this.documents.splice(index, 1)\n    this.events.documents.splice(index, 1)\n\n    this.fire('scope:remove-document', { doc, window, scope: this, options })\n  }\n\n  getDocIndex (doc: Document) {\n    for (let i = 0; i < this.documents.length; i++) {\n      if (this.documents[i].doc === doc) {\n        return i\n      }\n    }\n\n    return -1\n  }\n\n  getDocOptions (doc: Document) {\n    const docIndex = this.getDocIndex(doc)\n\n    return docIndex === -1 ? null : this.documents[docIndex].options\n  }\n\n  now () {\n    return (((this.window as any).Date as typeof Date) || Date).now()\n  }\n}\n\nexport function initScope (scope: Scope, window: Window | typeof globalThis) {\n  scope.isInitialized = true\n\n  if (is.window(window)) {\n    win.init(window)\n  }\n\n  domObjects.init(window)\n  browser.init(window)\n  raf.init(window)\n\n  // @ts-expect-error\n  scope.window = window\n  scope.document = window.document\n\n  scope.usePlugin(interactions)\n  scope.usePlugin(events)\n\n  return scope\n}\n\nfunction pluginIdRoot (id: string) {\n  return id && id.replace(/\\/.*$/, '')\n}\n"
	],
	"mappings": "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"
}